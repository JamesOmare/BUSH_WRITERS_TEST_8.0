{% extends 'base.html' %}

{% block stylesheets %}
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/styles.css') }}" >
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/card-styles.css') }}" >
{% endblock %}
    
{% block content %}

        <main>
        <div class="container py-4">
          <header class="pb-3 mb-4 border-bottom">
            <i class="bi bi-bell-fill bi-lg" style="font-size:24px;"></i>
              <span class="fs-4">Notifications Page</span>
            </a>
          </header>
    {% if buyer_msg %}

      {% for item in buyer_msg %}
            {% if item.type == 0 %}
              <div class="fm-content accepted" id="accepted">
                <form>
                  <fieldset disabled>
                      <div class="mb-3 title-time-display">
                          <label for="disabledTextInput" class="form-label label-text rounded bg-warning p-2">From: Admin</label>
                          <span class="text-white time-wait"><i class="bi bi-clock-history p-1"></i>{{ moment(item.time_posted).fromNow(refresh=True) }}</span>
                      </div>
                      <div class="mb-3">
                        <div class="card-body">
                          <h5 class="card-title yellow-text">Purchase Intent Alert</h5>
                          <br>
                          <p class="card-text text-white">
                            We have received the confirmation message sent and have verified it. Please wait while we contact the seller
                            so as to send you the account credentials to acertain validity of the account.

                          </p>
                          
                          <br>

                          <h5 class="card-title yellow-text mb-2">Purchased Account Details:</h5>
                          <table class="table table-dark table-striped">
                            <thead>
                              <tr>
                                <th scope="col">Account Name</th>
                                <th scope="col">Account Type</th>
                                <th scope="col">Account Brand</th>
                                <th scope="col">Account Price</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr>
                                <td>{{item.account.account_name}}</td>
                                <td>{{item.account.account_type.value | replace("_", "  ") | title}}</td>
                                <td>{{item.account.brand}}</td>
                                <td>{{item.account.price}}</td>
                              </tr>
                            </tbody>
                          </table>
                            
                      </div>
                  </fieldset>
                  <br/>
                  <div class="mb-3 text-white">
                  <p class="text">
                      <p><i class="bi bi-calendar3 me-2"></i><span>{{ moment(item.time_posted).format('LLL') }}.</span></p>
                      <input class="btn btn-primary close_accept" type="button" value="Close" id="{{ item.id }}" onclick="delete_msg(this)">
                      <br/>                  
                  </div> 
                </form>
              </div>
              <br>
            {% endif %}

            {% if item.type == 1 %}
              <div class="fm-content" id="rejected">
                <form>
                  <fieldset disabled>
                      <div class="mb-3 title-time-display">
                          <label for="disabledTextInput" class="form-label label-text rounded bg-warning p-2">From: Admin</label>
                          <span class="text-white time-wait"><i class="bi bi-clock-history p-1"></i>{{ moment(item.time_posted).fromNow(refresh=True) }}</span>
                      </div>
                      <div class="mb-3">
                        <div class="card-body">
                          <h5 class="card-title text-white">Verification Message Failed Alert</h5>
                          <p class="card-text text-white">
                            The confirmation message sent to us failed to be authenticated within the given time. please contact our suppport 
                            centre for assistance or try again.
                          </p>
                       
                      </div>
                  </fieldset>
                  <br/>
                  <div class="mb-3 text-white">
                  
                      
                      <p>{{ moment(item.time_posted).format('LLL') }}.</p>
                      
                      <input class="btn btn-primary" type="submit" value="Close" id="{{ item.id }}" onclick="delete_msg(this)">
                      <br/>                  
                  </div> 
                </form>
              </div>
              <br>
            {% endif %}

            {% if item.type == 2 %}
                <div class="accordion fm-content" id="accordionExample">    
                    <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                      <div class="accordion-body ">
                        <fieldset disabled>
                          <div class="mb-3 title-time-display">
                              <label for="disabledTextInput" class="form-label label-text rounded bg-warning p-2">From: Admin</label>
                              <span class="text-white time-wait"><i class="bi bi-clock-history p-1"></i>{{ moment(item.time_posted).fromNow(refresh=True) }}</span>
                          </div>

                          <div>
                            <p class="mb-3 text-white">
                              This is the credentials for account <span class="yellow-text">{{ item.account.account_name }}</span>. Check the account credentials, 
                              status to validate authenticity of the account before clicking the confirmation button.
                              <br>
                              <i class="bi bi-exclamation-triangle warning-red">
                                Do not change account credentials in this step.
                              </i>
                            </p>
                          </div>

                          {% for account in accounts %}
                          {% if account.account_id == item.account_id %}
                          <div class="mb-3">
                            <label for="disabledTextInput" class="form-label text-white">Account Email</label>
                            <input type="text" id="account-val" value="{{account.account_email}}" class="form-control" placeholder="Disabled input">
                          </div>
  
                          <div class="mb-3">
                            <label for="disabledTextInput" class="form-label text-white">Account Url</label>
                            <input type="text" id="account-val" value="{{account.account_url}}" class="form-control" placeholder="Disabled input">
                          </div>
  
                          <div class="mb-3">
                            <label for="disabledTextInput" class="form-label text-white">Account Passphrase</label>
                            <input type="text" id="account-val" value="{{account.account_passphrase}}" class="form-control" placeholder="Disabled input">
                          </div>
                          {% endif %}
                          {% endfor %}
                        </fieldset>
                      </div>
                    </div>

                    <br/>
                    <div class="mb-3 text-white">
                    <p class="text">
                        <i class="bi bi-exclamation-triangle warning-red">
                          You have 24 hours from {{ moment(item.time_posted).format('LLL') }} to raise a complaint upon which a refund can be offered !
                        </i>
                        <p>{{ moment(item.time_posted).format('LLL') }}.</p>
                        <form action="" method="POST">
                          <div class="form-group">
                            {{ accept_form.csrf_token() }}
                            {{ accept_form.seller_id(value = item.seller_id) }}
                            {{ accept_form.account_id(value = item.account_id) }}
                            {{ accept_form.accept(class="btn btn-primary") }}
                            <button class="btn btn-success" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                              Close/Open
                            </button>
                          </div>
                        </form>
                        
                       
                        <br/> 
                    </div> 


                  <div class="accordion fm-content" id="accordionExample2">
                    <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample2">
                      <div class="accordion-body">
                        <form action="" method="POST">
                          {{ form.csrf_token }}
                              <!-- Reason -->
                              <div class="form-group">
                                {{ form.reason.label(class="form-control-label text-white") }}
                                {% if form.reason.errors %}
                                    {{ form.reason(class="form-control form-control-lg is-invalid") }}
                                    <div class="invalid-feedback">
                                        {% for error in form.reason.errors %}
                                            <span>{{ error }}</span>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    {{ form.reason(class="form-control form-control-lg") }}
                                {% endif %}
                              </div>
    
                            <!-- Extended Description -->
                            <div class="form-group">
                              {{ form.extended_reason.label(class="form-control-label text-white") }}
                              {% if form.extended_reason.errors %}
                                  {{ form.extended_reason(class="form-control form-control-lg is-invalid") }}
                                  <div class="invalid-feedback">
                                      {% for error in form.extended_reason.errors %}
                                          <span>{{ error }}</span>
                                      {% endfor %}
                                  </div>
                              {% else %}
                                  {{ form.extended_reason(class="form-control form-control-lg") }}
                              {% endif %}
                            </div>
                            
                            {{ form.account_id(value=item.account_id) }}
                            {{ form.seller_id(value=item.seller_id) }}
                            <div class="form-group">
                              {{ form.submit(class="btn btn-danger mt-3") }}
                            </div>
                        </form>
                      </div>
                    </div>
                    <p class="text-white">If you are not satisfied with the account, please fill the rejection form here:</p>
                    <h2 class="accordion-header" id="headingTwo">
                      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                        Rejection Form
                      </button>
                    </h2>
                  </div>
                </div>
                <br>
            {% endif %}

            {% if item.type == 3 %}
            <div class="fm-content accepted" id="accepted">
                <fieldset >
                    <div class="mb-3 title-time-display">
                        <label for="disabledTextInput" class="form-label label-text rounded bg-warning p-2">From: Admin</label>
                        <span class="text-white time-wait"><i class="bi bi-clock-history p-1"></i>{{ moment(item.time_posted).fromNow(refresh=True) }}</span>
                    </div>
                    <div class="mb-3">
                      <div class="card-body">
                        <h5 class="card-title yellow-text">Successful Purchase Alert</h5>
                        <br>
                        <p class="card-text text-white">
                          We have received your confirmation request for the purchased account and have approved it. If the account you are purchasing 
                          requires further documents i.e account certificate, license e.t.c., you can proceed to request those documents from the seller below. if the account 
                          you intend to purchase doesn't require such documents, you can proceed to click the complete purchase option. 
                          <br>                 
                        </p>
                        <div>

                          <!-- form for buyer to choose purchase status -->
                          <form action="" method="POST">
                            {{ purchase_status.csrf_token }}
                            {{ purchase_status.seller_id(value = item.seller_id ) }}
                            {{ purchase_status.account_id(value = item.account_id ) }}
                            
                            <button type="submit" name="completed" value="true" class="btn btn-success mt-3 me-3">
                              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-circle me-1" viewBox="0 0 16 16">
                                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path>
                                <path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"></path>
                              </svg>
                              Complete Purchase
                            </button>

                            <button type="submit" name="additional_info" value="true" class="btn btn-info mt-3 me-3">
                              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-send-fill" viewBox="0 0 16 16">
                                <path d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083l6-15Zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471-.47 1.178Z"></path>
                              </svg>
                              Request Additional Credentials
                            </button>
                          </form>

                        </div>                            
                    </div>
                </fieldset>
                <br/>
                <div class="mb-3 text-white">
                    <p>{{ moment(item.time_posted).format('LLL') }}.</p>
                    <input class="btn btn-primary" type="submit" value="Close" id="{{ item.id }}" onclick="delete_msg(this)">
                    <br/>                  
                </div> 
            </div>
            {% endif %}

            {% if item.type == 4 %}
            <div class="fm-content accepted" id="accepted">
                <form>
                  <fieldset disabled>
                      <div class="mb-3 title-time-display">
                          <label for="disabledTextInput" class="form-label label-text rounded bg-warning p-2">From: Admin</label>
                          <span class="text-white time-wait"><i class="bi bi-clock-history p-1"></i>{{ moment(item.time_posted).fromNow(refresh=True) }}</span>
                      </div>
                      <div class="mb-3">
                        <div class="card-body">
                          <h5 class="card-title warning-red">Failed Purchase Alert</h5>
                          <p class="card-text text-white">
                            We have received the complaint message sent and still reviewing the complaint. We apologize for the account not meeting your expectation and will begin the  
                            refund process within our <a href="#" data-bs-toggle="modal" data-bs-target="#exampleModal">terms of service</a> .
                            
                            <p class="text-white">
                              You can check out other accounts of the same price range before the refund is executed(Before 24 hours from {{ moment(item.time_posted).fromNow(refresh=True) }} here)
                            </p>
                          </p>                      
                      </div>
                  </fieldset>
                  <br/>
                  <div class="mb-3">
                  
                      <i class="bi bi-exclamation-triangle warning-red">
                      We will issue you with a refund as per our terms of service within 24 hours !
                      </i>
                      <p class="text-white">{{ moment(item.time_posted).format('LLL') }}.</p>
                      
                      <input class="btn btn-primary" type="submit" value="Close">
                      <br/>                  
                  </div> 
                </form>
              </div>
              <!--TOS Modal -->
                <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                  <div class="modal-content">
                      <div class="modal-header bg-dark">
                          <h5 class="modal-title text-white" id="exampleModalLabel">Terms Of Service</h5>
                          <button type="button" class="text-white btn-close " data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body px-2">
                          <ul>
                              <li>One must register to do any transactions within the market place </li>
                              <li> The buyers must do money transaction through the official marketplace accounts using their registered details. If not so, it must be communicated clearly. The buyer must indicate the account ID while doing the verification</li>
                              <li>Transaction will only be complete when the buyer is satisfied with the account. This is when the seller will receive payment and must send other credentials for the account.</li>
                              <li>The seller only send the logins of the account to the buyer for verification.</li>
                              <li>Incase of unmet qualities, the buyer is linked directly to the seller for more account clarification, after which the transaction will be complete or a refund will be initiated.</li>
                              <li>Buyer is given 12hours to reject the account. After receiving all account details and payment is done to the seller, no complains will be accepted.</li>
                              <li>The marketplace is only responsible for the transactions done through the marketplace. Any transaction done outside is at your own risk.</li>
                              <li>The reversal of any fund will constitute a 5% fine + admin fees. </li>
                              <li>If the buyer rejects an account but goes on and change the account details, this will lead to 50-100% fine on the purchase fees.</li>
                              <li>If the seller fails to upload the credentials of the account, this will result to 50-100% fine on the purchased fees.</li>
                          </ul>
                      </div>
                      <div class="modal-footer bg-dark">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                      </div>
                  </div>
                  </div>
                </div>
            {% endif %}

            {% if item.type == 5 %}
              <div class="fm-content accepted" id="accepted">
                <fieldset >
                    <div class="mb-3 title-time-display">
                        <label for="disabledTextInput" class="form-label label-text rounded bg-warning p-2">From: Admin</label>
                        <span class="text-white time-wait"><i class="bi bi-clock-history p-1"></i>{{ moment(item.time_posted).fromNow(refresh=True) }}</span>
                    </div>
                    <div class="mb-3">
                      <div class="card-body">
                        <h5 class="card-title yellow-text">Completed Purchase Alert</h5>
                        <br>
                        <p class="card-text text-white">
                          We have received your confirmation request to finalize purchase of the account <span class="yellow-text">{{ item.account.account_name }}</span>  and have finalized it.
                          You are free to use the account and are highly advised to change the credentials at this point.
                          <br>                 
                        </p>

                        <h5 class="card-title yellow-text mb-2">Purchased Account Details:</h5>
                          <table class="table table-dark table-striped">
                            <thead>
                              <tr>
                                <th scope="col">Account Name</th>
                                <th scope="col">Account Type</th>
                                <th scope="col">Account Brand</th>
                                <th scope="col">Account Price</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr>
                                <td>{{item.account.account_name}}</td>
                                <td>{{item.account.account_type.value | replace("_", "  ") | title}}</td>
                                <td>{{item.account.brand}}</td>
                                <td>{{item.account.price}}</td>
                              </tr>
                            </tbody>
                          </table>
                    </div>
                </fieldset>
                <br/>
                <div class="mb-3 text-white">
                <p class="text">
                  <i class="bi bi-exclamation-triangle warning-red">
                    You are advised to change account credentials at this point.
                  </i>   
                    <p>{{ moment(item.time_posted).format('LLL') }}.</p>
                    <button type="submit" class="btn btn-primary" id="{{ item.id }}" onclick="delete_msg(this)"><i class="bi bi-x-square me-1"></i>Close</button>
                    <br/>                  
                </div> 
            </div>
            {% endif %}
 
          <br>
    {% endfor %}
    {% endif %}

    {% if seller_msg %}
      {% for item in seller_msg %}
              {% if item.type == 0 %}
                <div class="fm-content">
                  <div class="mb-3 title-time-display">
                      <label for="disabledTextInput" class="form-label label-text rounded bg-warning p-2">From: Admin</label>
                      <span class="text-white time-wait"><i class="bi bi-clock-history p-1"></i>{{ moment(item.time_posted).fromNow(refresh=True) }}</span>
                  </div>
                  <div class="mb-3">
                      <div class="card-body">
                        <h5 class="card-title yellow-text">Buyer Intent Alert</h5>
                        <br>
                        <p class="card-text text-white">
                          We have received payment from a buyer for your account. Please provide account details to the admin for account verification.
                        </p>                
                      </div>
                  </div>
                  
                  <br/>

                  <h5 class="card-title yellow-text mb-2">Purchase On Progress Account Details:</h5>
                 
                  <table class="table table-dark table-striped">
                    <thead>
                      <tr>
                        <th scope="col">Account Name</th>
                        <th scope="col">Account Type</th>
                        <th scope="col">Account Brand</th>
                        <th scope="col">Account Price</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>{{item.account.account_name}}</td>
                        <td>{{item.account.account_type.value | replace("_", "  ") | title}}</td>
                        <td>{{item.account.brand}}</td>
                        <td>{{item.account.price}}</td>
                      </tr>
                    </tbody>
                  </table>

                  <form action="" method="POST">
                    {{ seller_form.csrf_token }}
                    {{ seller_form.hidden_tag(seller_form.buyer_id(), seller_form.account_id()) }}
             
                        <!-- Seller's account Email -->
                        <div class="form-group">
                          {{ seller_form.account_email.label(class="form-control-label text-white") }}
                          {% if seller_form.account_email.errors %}
                              {{ seller_form.account_email(class="form-control form-control-lg is-invalid") }}
                              <div class="invalid-feedback">
                                  {% for error in seller_form.account_email.errors %}
                                      <span>{{ error }}</span>
                                  {% endfor %}
                              </div>
                          {% else %}
                              {{ seller_form.account_email(class="form-control form-control-lg") }}
                          {% endif %}
                        </div>

                        <!-- Seller's account Url -->
                        <div class="form-group">
                          {{ seller_form.account_url.label(class="form-control-label text-white") }}
                          {% if seller_form.account_url.errors %}
                              {{ seller_form.account_url(class="form-control form-control-lg is-invalid") }}
                              <div class="invalid-feedback">
                                  {% for error in seller_form.account_url.errors %}
                                      <span>{{ error }}</span>
                                  {% endfor %}
                              </div>
                          {% else %}
                              {{ seller_form.account_url(class="form-control form-control-lg") }}
                          {% endif %}
                        </div>

                        <!-- Seller's account Passphrase -->
                        <div class="form-group">
                          {{ seller_form.account_passphrase.label(class="form-control-label text-white") }}
                          {% if seller_form.account_passphrase.errors %}
                              {{ seller_form.account_passphrase(class="form-control form-control-lg is-invalid") }}
                              <div class="invalid-feedback">
                                  {% for error in seller_form.account_passphrase.errors %}
                                      <span>{{ error }}</span>
                                  {% endfor %}
                              </div>
                          {% else %}
                              {{ seller_form.account_passphrase(class="form-control form-control-lg") }}
                          {% endif %}
                        </div>

                        {{ seller_form.buyer_id(value='{}'.format(item.buyer_id)) }}
                        {{ seller_form.account_id(value='{}'.format(item.account.account_id)) }}
                        <div class="form-group">
                          {{ seller_form.submit(class="btn btn-danger mt-3") }}
                        </div>

                  </form>
                  <br>
                  
                  <div class="mb-3 text-white">                 
                      <p>{{ moment(item.time_posted).format('LLL') }}.</p>   
                      <input class="btn btn-primary close_accept" type="button" value="Close" id="{{ item.id }}" onclick="delete_msg(this)">       
                      <br/>                  
                  </div> 
              </div>
              <br>

              {% endif %}
             
      
              {% if item.type == 2 %}
                  <div class="fm-content">
                    <div class="mb-3 title-time-display">
                        <label for="disabledTextInput" class="form-label label-text rounded bg-warning p-2">From: Admin</label>
                        <span class="text-white time-wait"><i class="bi bi-clock-history p-1"></i>{{ moment(item.time_posted).fromNow(refresh=True) }}</span>
                    </div>
                    <div class="mb-3">
                        <div class="card-body">
                          <h5 class="card-title yellow-text">Awaiting Buyer Confirmation Alert</h5>
                          <br>
                          <p class="card-text text-white">
                            We have sent the account detail credentials to the potential buyer. Please wait while they review the account to detemine
                            whether to proceed with purchase of the account. 
                          </p>                
                        </div>
                    </div>
                    
                    <br/>

                    <h5 class="card-title yellow-text mb-2">Account Details:</h5>
                  
                    <table class="table table-dark table-striped">
                      <thead>
                        <tr>
                          <th scope="col">Account Name</th>
                          <th scope="col">Account Type</th>
                          <th scope="col">Account Brand</th>
                          <th scope="col">Account Price</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>{{item.account.account_name}}</td>
                          <td>{{item.account.account_type.value | replace("_", "  ") | title}}</td>
                          <td>{{item.account.brand}}</td>
                          <td>{{item.account.price}}</td>
                        </tr>
                      </tbody>
                    </table>
                    <hr class="text-white">

                    <br>
                    
                    <div class="mb-3 text-white">                 
                        <p>{{ moment(item.time_posted).format('LLL') }}.</p>   
                        <input class="btn btn-primary close_accept" type="button" value="Close" id="{{ item.id }}" onclick="delete_msg(this)">       
                        <br/>                  
                    </div> 
                </div>
                <br>
              {% endif %}

              {% if item.type == 3 %}
                 <div class="fm-content">
                  <div class="mb-3 title-time-display">
                      <label for="disabledTextInput" class="form-label label-text rounded bg-warning p-2">From: Admin</label>
                      <span class="text-white time-wait"><i class="bi bi-clock-history p-1"></i>{{ moment(item.time_posted).fromNow(refresh=True) }}</span>
                  </div>
                  <div class="mb-3">
                      <div class="card-body">
                        <h5 class="card-title yellow-text">Additional Information Alert</h5>
                        <br>
                        <p class="card-text text-white">
                          We have received confirmation from the buyer to proceed with the account purchase. If your account requires additional documents ie account certificate, account license e.t.c, you will receive a request 
                          to provide the documents from the buyer shortly. If the account under sale doesn't require such documents you will receive a prompt to enter your account details i.e paypal email or phone number to complete 
                          the payment process. 
                        </p>                
                      </div>
                  </div>
                  
                  <br/>

                  <h5 class="card-title yellow-text mb-2">Purchased Account Details:</h5>
                 
                  <table class="table table-dark table-striped">
                    <thead>
                      <tr>
                        <th scope="col">Account Name</th>
                        <th scope="col">Account Type</th>
                        <th scope="col">Account Brand</th>
                        <th scope="col">Account Price</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>{{item.account.account_name}}</td>
                        <td>{{item.account.account_type.value | replace("_", "  ") | title}}</td>
                        <td>{{item.account.brand}}</td>
                        <td>{{item.account.price}}</td>
                      </tr>
                    </tbody>
                  </table>
                  <hr class="text-white">

                  <br>
                  
                  <div class="mb-3 text-white">                 
                      <p>{{ moment(item.time_posted).format('LLL') }}.</p>   
                      <input class="btn btn-primary close_accept" type="button" value="Close" id="{{ item.id }}" onclick="delete_msg(this)">       
                      <br/>                  
                  </div> 
              </div>
              <br>
              {% endif %}

              {% if item.type == 4 %}
              <div class="fm-content accepted" id="accepted">
                <form>
                  <fieldset disabled>
                      <div class="mb-3 title-time-display">
                          <label for="disabledTextInput" class="form-label label-text rounded bg-warning p-2">From: Admin</label>
                          <span class="text-white time-wait"><i class="bi bi-clock-history p-1"></i>{{ moment(item.time_posted).fromNow(refresh=True) }}</span>
                      </div>
                      <div class="mb-3">
                        <div class="card-body">
                          <h5 class="card-title yellow-text">Failed Purchase Alert</h5>
                          <br>
                          <p class="card-text text-white">
                            The buyer of your account has pulled out from the purchase process. We will review the reason and during this process your account won't be 
                            publicly available in the marketplace for 24 hrs from {{ moment(item.time_posted).fromNow(refresh=True) }}.

                            You are advised to change the account credentials immediately.
                            <br>                 
                          </p>
                          
                      </div>
                  </fieldset>
                  <br/>
                  <div class="mb-3 text-white">
                  <p class="text">
                    <i class="bi bi-exclamation-triangle warning-red">
                      You are advised to change account credentials at this point.
                    </i>   
                      <p>{{ moment(item.time_posted).format('LLL') }}.</p>
                      <input class="btn btn-primary" type="submit" value="Close" id="{{ item.id }}" onclick="delete_msg(this)">
                      <br/>                  
                  </div> 
                </form>
              </div>
              {% endif %}

              {% if item.type == 5 %}
              <div class="fm-content accepted" id="accepted">
                <fieldset >
                    <div class="mb-3 title-time-display">
                        <label for="disabledTextInput" class="form-label label-text rounded bg-warning p-2">From: Admin</label>
                        <span class="text-white time-wait"><i class="bi bi-clock-history p-1"></i>{{ moment(item.time_posted).fromNow(refresh=True) }}</span>
                    </div>
                    <div class="mb-3">
                      <div class="card-body">
                        <h5 class="card-title yellow-text">Completed Purchase Alert</h5>
                        <br>
                        <p class="card-text text-white">
                          We have received confirmation from the buyer to finalize purchase of one of your accounts, <span class="yellow-text">{{ item.account.account_name }}</span>, listed below and have finalized it.
                          You will receive {{ item.account.price }} minus charges as per our terms of service <a href="#" data-bs-toggle="modal" data-bs-target="#exampleModal">here.</a>
                          You can choose method of payment below.
                          <br>                 
                        </p>
                        <br>

                        <h5 class="card-title yellow-text mb-2">Purchased Account Details:</h5>
                          <table class="table table-dark table-striped">
                            <thead>
                              <tr>
                                <th scope="col">Account Name</th>
                                <th scope="col">Account Type</th>
                                <th scope="col">Account Brand</th>
                                <th scope="col">Account Price</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr>
                                <td>{{item.account.account_name}}</td>
                                <td>{{item.account.account_type.value | replace("_", "  ") | title}}</td>
                                <td>{{item.account.brand}}</td>
                                <td>{{item.account.price}}</td>
                              </tr>
                            </tbody>
                          </table>


                          <div class="mb-4">
                            <h4 class="d-flex justify-content-between align-items-center mb-3">
                              <span class="text-white">Summary</span>
                            </h4>
                            <ul class="list-group mb-3">
                              <li class="list-group-item d-flex justify-content-between lh-condensed">
                                <div>
                                  <h6 class="my-0">Account type</h6>
                                  <small class="text-muted">Type of Account</small>
                                </div>
                                <span class="text-success">{{item.account.account_type.value | replace("_", "  ") | title }}</span>
                              </li>
                              <li class="list-group-item d-flex justify-content-between bg-light">
                                <div>
                                  <h6 class="my-0">Account name</h6>
                                  <small class="text-muted">Name of the account</small>
                                </div>
                                <span class="text-success">{{ item.account.account_name }}</span>
                              </li>
                              <li class="list-group-item d-flex justify-content-between lh-condensed">
                                <div>
                                  <h6 class="my-0">Account Price</h6>
                                  <small class="text-muted">Cost of the account listed</small>
                                </div>
                                <span class="text-success">ksh {{ item.account.price }}/=</span>
                              </li>

                              <!-- commision -->
                              {% set commission = item.account.price * 0.02 %}
                              <li class="list-group-item d-flex justify-content-between bg-light">
                                <div class="text-success">
                                  <h6 class="my-0">Commission Fee</h6>
                                  <small class="text-muted">Constitutes 2% of initial fee</small>
                                </div>
                                <span class="text-success">Ksh {{ "%.2f"|format(commission) }}/=</span>
                              </li>
                              <li class="list-group-item d-flex justify-content-between bg-light">
                                <div class="text-success">
                                  <h6 class="my-0">Administration Charge</h6>
                                  <small class="text-muted">Handling fee</small>
                                </div>
                                <span class="text-success">Ksh 200/=</span>
                              </li>
                              {% set total = item.account.price - 200 %}
                              <li class="list-group-item d-flex justify-content-between">
                                <span>Total (KSH)</span>
                                <strong class="text-success">{{ "%.2f"|format(total) }}/=</strong>
                              </li>
                            </ul>
                          </div>
                    </div>
                </fieldset>
                <br/>
                <div class="mb-3 text-white">
                    <p>{{ moment(item.time_posted).format('LLL') }}.</p>
                    <button type="submit" class="btn btn-primary" id="{{ item.id }}" onclick="delete_msg(this)"><i class="bi bi-x-square me-1"></i>Close</button>
                    <br/>                  
                </div> 
            </div>

            <!--TOS Modal -->
            <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
              <div class="modal-content">
                  <div class="modal-header bg-dark">
                      <h5 class="modal-title text-white" id="exampleModalLabel">Terms Of Service</h5>
                      <button type="button" class="text-white btn-close " data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body px-2">
                      <ul>
                          <li>One must register to do any transactions within the market place </li>
                          <li> The buyers must do money transaction through the official marketplace accounts using their registered details. If not so, it must be communicated clearly. The buyer must indicate the account ID while doing the verification</li>
                          <li>Transaction will only be complete when the buyer is satisfied with the account. This is when the seller will receive payment and must send other credentials for the account.</li>
                          <li>The seller only send the logins of the account to the buyer for verification.</li>
                          <li>Incase of unmet qualities, the buyer is linked directly to the seller for more account clarification, after which the transaction will be complete or a refund will be initiated.</li>
                          <li>Buyer is given 12hours to reject the account. After receiving all account details and payment is done to the seller, no complains will be accepted.</li>
                          <li>The marketplace is only responsible for the transactions done through the marketplace. Any transaction done outside is at your own risk.</li>
                          <li>The reversal of any fund will constitute a 5% fine + admin fees. </li>
                          <li>If the buyer rejects an account but goes on and change the account details, this will lead to 50-100% fine on the purchase fees.</li>
                          <li>If the seller fails to upload the credentials of the account, this will result to 50-100% fine on the purchased fees.</li>
                      </ul>
                  </div>
                  <div class="modal-footer bg-dark">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                  </div>
              </div>
              </div>
            </div>
            
            {% endif %}

              {% if item.type == 6 %}
              <div class="fm-content accepted" id="accepted">
                <form method="POST" enctype="multipart/form-data">
                  {{ seller_form.csrf_token }}
                  <fieldset >
                      <div class="mb-3 title-time-display">
                          <label for="disabledTextInput" class="form-label label-text rounded bg-warning p-2">From: Admin</label>
                          <span class="text-white time-wait"><i class="bi bi-clock-history p-1"></i>{{ moment(item.time_posted).fromNow(refresh=True) }}</span>
                      </div>
                      <div class="mb-3">
                        <div class="card-body">
                          <h5 class="card-title yellow-text">Additional Account Information Request</h5>
                          <br>
                          <p class="card-text text-white">
                            The buyer of your account has requested for additional account credentials account credentials i.e. account certificate, account owner phone number, account licenses and any other document relevant to the account. 
                            You may upload them as document form (strictly pdf) or image form.
                            <br> 
                            <div class="pt-2">
                              <button type="button" class="btn btn-info" data-bs-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample"><i class="bi bi-upload bt-icon me-2"></i>Upload Credentials</button>
                            </div>                
                          </p>
                          
                          
                          <!-- Accordion Upload Account Details -->
                          <div class="col-12 p-3 collapse" id="collapseExample">
                            <div class="card">
                            <div class="card-header font-weight-bold">Available features</div>
                            <div class="card-body">

                                <!-- Documents upload -->
                                <div class="form-group">
                                  {{ seller_form_complete.account_credentials.label(class="form-control-label") }}<b style="color: #dc3545;">*</b><span style="color: #dc3545;"> (only pdf files are accepted, max: 5 files.)</span>
                                  {% if seller_form_complete.account_credentials.errors %}
                                      {{ seller_form_complete.account_credentials(class="form-control form-control-lg is-invalid") }}
                                      <div class="invalid-feedback">
                                          {% for error in seller_form_complete.account_credentials.errors %}
                                              <span>{{ error }}</span>
                                          {% endfor %}
                                      </div>
                                  {% else %}
                                      {{ seller_form_complete.account_credentials(class="form-control form-control-lg") }}
                                  {% endif %}
                                </div>

                                <!-- Seller's Phone number -->
                                <div class="form-group">
                                  {{ seller_form_complete.account_owner_number.label(class="form-control-label") }}<b style="color: #dc3545;">*</b>
                                  {% if seller_form_complete.account_owner_number.errors %}
                                      {{ seller_form_complete.account_owner_number(class="form-control form-control-lg is-invalid") }}
                                      <div class="invalid-feedback">
                                          {% for error in seller_form_complete.account_owner_number.errors %}
                                              <span>{{ error }}</span>
                                          {% endfor %}
                                      </div>
                                  {% else %}
                                      {{ seller_form_complete.account_owner_number(class="form-control form-control-lg") }}
                                  {% endif %}
                                </div>
                                {{ seller_form.buyer_id(value=item.buyer_id) }}
                                {{ seller_form.account_id(value=item.account.account_id) }}
                                <hr>
                                <div class="text-center text-muted"><b style="color: #dc3545;">*</b> The fields marked with * are required</div>                         

                            </div>
                            <div class="card-footer">
                              {{ seller_form_complete.submit(class="btn btn-danger") }}
                            </div>
                          </div>
                      </div>
                          
                          
                      </div>
                  </fieldset>
                  <br/>
                  <div class="mb-3 text-white">
                      <p>{{ moment(item.time_posted).format('LLL') }}.</p>
                      <button type="submit" class="btn btn-primary" id="{{ item.id }}" onclick="delete_msg(this)"><i class="bi bi-x-square me-1"></i>Close</button>
                      <br/>                  
                  </div> 
                </form>
              </div>
              {% endif %}

              {% if item.type == 7 %}
              <div class="fm-content accepted" id="accepted">
                <form>
                  <fieldset disabled>
                      <div class="mb-3 title-time-display">
                          <label for="disabledTextInput" class="form-label label-text rounded bg-warning p-2">From: Admin</label>
                          <span class="text-white time-wait"><i class="bi bi-clock-history p-1"></i>{{ moment(item.time_posted).fromNow(refresh=True) }}</span>
                      </div>
                      <div class="mb-3">
                        <div class="card-body">
                          <h5 class="card-title yellow-text">Awaiting Purchase Alert</h5>
                          <br>
                          <p class="card-text text-white">
                            We have received the submitted documents and will be reviewing them before sending it to the buyer for confirmation. Once the buyer
                            validates the documents authenticity, this will conclude the transaction and you will receive payment as per our <a href="#" data-bs-toggle="modal" data-bs-target="#exampleModal">terms of service</a>.
                            <br>                 
                          </p>
                          
                      </div>
                  </fieldset>
                  <br/>
                  <div class="mb-3 text-white">
                      <p>{{ moment(item.time_posted).format('LLL') }}.</p>
                      <input class="btn btn-primary" type="submit" value="Close" id="{{ item.id }}" onclick="delete_msg(this)">
                      <br/>                  
                  </div> 
                </form>
              </div>

              <!--TOS Modal -->
              <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header bg-dark">
                        <h5 class="modal-title text-white" id="exampleModalLabel">Terms Of Service</h5>
                        <button type="button" class="text-white btn-close " data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body px-2">
                        <ul>
                            <li>One must register to do any transactions within the market place </li>
                            <li> The buyers must do money transaction through the official marketplace accounts using their registered details. If not so, it must be communicated clearly. The buyer must indicate the account ID while doing the verification</li>
                            <li>Transaction will only be complete when the buyer is satisfied with the account. This is when the seller will receive payment and must send other credentials for the account.</li>
                            <li>The seller only send the logins of the account to the buyer for verification.</li>
                            <li>Incase of unmet qualities, the buyer is linked directly to the seller for more account clarification, after which the transaction will be complete or a refund will be initiated.</li>
                            <li>Buyer is given 12hours to reject the account. After receiving all account details and payment is done to the seller, no complains will be accepted.</li>
                            <li>The marketplace is only responsible for the transactions done through the marketplace. Any transaction done outside is at your own risk.</li>
                            <li>The reversal of any fund will constitute a 5% fine + admin fees. </li>
                            <li>If the buyer rejects an account but goes on and change the account details, this will lead to 50-100% fine on the purchase fees.</li>
                            <li>If the seller fails to upload the credentials of the account, this will result to 50-100% fine on the purchased fees.</li>
                        </ul>
                    </div>
                    <div class="modal-footer bg-dark">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
                </div>
              </div>
              {% endif %}
              
      {% endfor %}      
    {% endif %}
    

    {% if not buyer_msg and not seller_msg %}
    <p>You have no notifications.</p>
    <input type="button" class="btn btn-dark" value="Go back!" onclick="history.back()">
    {% endif %}
      

  
</div>
</main>

    
{% endblock content %}

{% block sidebar %}
  <div class="col-md-4 sidebar">
    <div class="content-section">
      <!-- Sell Account Details -->
      <h3 class="side-title">Sell Account</h3>
      <p class='text-muted side-text'>Place an ad on an account you want to sell.
        <!--Widget Start-->
        <div class="card-body card-sidebar color1">
          <div class="float-left">
            <p>Account Ad</p>
              <h3>
                  <span class="currency">Sell</span>
              </h3>
            
          </div>
          <div class="float-right">
            <i class="bi bi-cash-coin"></i>
          </div>
        </div>
        <!--Widget End-->
      </p>
      <div class="d-grid gap-2 col-11 mx-auto">
        <a href="{{ url_for('main.seller') }}" role="button" class="btn btn-warning">Sell Account</a>
      </div>
      <br/>
      <hr class="text-white">

      <h3 class="side-title">Buy Account</h3>
      <p class='text-muted side-text'>View marketplace to explore listings on accounts for sale.
       <!--Widget Start-->
       <div class="card-body card-sidebar color2">
        <div class="float-left">
          <p>Visit</p>
            <h3>
                <span class="currency">Listings</span>
            </h3>
          
        </div>
        <div class="float-right">
          <i class="bi bi-cart4"></i>
        </div>
      </div>
      <!--Widget End-->
      </p>
      <div class="d-grid gap-2 col-11 mx-auto">
        <a href="{{ url_for('main.viewpage') }}" role="button" class="btn btn-warning">Visit Marketplace</a>
      </div>
      <br/>
      <hr class="text-white">


      <h3 class="side-title">Customer Support</h3>
      <p class='text-muted side-text'>Our Support center is always one call away.
       <!--Widget Start-->
       <div class="card-body card-sidebar color4">
        <div class="float-left">
          <p>Client</p>
            <h3>
                <span class="currency">Support</span>
            </h3>
        </div>
        <div class="float-right">
          <i class="bi bi-headset"></i>
        </div>
      </div>
      <!--Widget End-->
      </p>
     

    </div>
  </div>
  <br/>
  
{% endblock sidebar %}

{% block footer %}
<div class="border-top pt-3"></div>
<div class="footer-container">
  <footer class="py-5">
    <div class="row">

      <div class="col-6 col-md-2 mb-3">
        <h5 class="text-white">Get In Touch</h5>
        <ul class="nav flex-column">
          <li class="nav-item mb-2"><p class="nav-link p-0 footer-color"><i class="bi bi-geo-alt-fill mr-2"></i>Juja</p></li>
          <li class="nav-item mb-2"><p class="nav-link p-0 footer-color"><i class="bi bi-telephone-fill mr-2"></i>+254743635629</p></li>
          <li class="nav-item mb-2"><p class="nav-link p-0 footer-color"><i class="bi bi-envelope-fill mr-2"></i>bushwriters@gmail.com</p></li>
          <li class="nav-item mb-2"><p class="nav-link p-0 footer-color"><i class="bi bi-whatsapp mr-2"></i>+254743635629</p></li>
          <li class="nav-item mb-2"><p class="nav-link p-0 footer-color"><i class="bi bi-headset mr-2"></i>Customer Support, Sun - Fri, 7AM-10PM</p></li>
        </ul>
      </div>

      <div class="col-6 col-md-2 mb-3">
        <h5 class="text-white">Quick Links</h5>
        <ul class="nav flex-column">
          <li class="nav-item mb-2"><a href="{{ url_for('main.viewpage') }}" class="nav-link p-0 footer-color">Home</a></li>
          <li class="nav-item mb-2"><a href="{{ url_for('main.guide') }}" class="nav-link p-0 footer-color">Guide</a></li>
          <li class="nav-item mb-2"><a href="{{ url_for('main.seller') }}" class="nav-link p-0 footer-color">Become A Seller</a></li>
          <li class="nav-item mb-2"><a href="{{ url_for('main.contact_us') }}" class="nav-link p-0 footer-color">Contact Us</a></li>
        </ul>
      </div>

      

      <div class="col-md-5 offset-md-1 mb-3">
        <form>
          <h5 class="text-white">Subscribe to our newsletter</h5>
          <p class="footer-color">Monthly digest of what's new and exciting from us.</p>
          <div class="input-group">
            <input type="text" class="form-control" placeholder="Email Address" aria-label="Recipient's email input" aria-describedby="button-addon4">
            <div class="input-group-append" id="button-addon4">
              <button class="btn btn-primary" type="button">Subscribe</button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <div class="d-flex flex-column flex-sm-row justify-content-between py-4 my-4 border-top">
      <p class="text-white">&copy; 2022 Company, Inc. All rights reserved.</p>
      <ul class="list-unstyled d-flex">
        <i class="bi bi-twitter p-2 text-white"></i>
        <i class="bi bi-instagram p-2 text-white"></i>
        <i class="bi bi-facebook p-2 text-white"></i>
        <li class="ms-3"><a class="text-white" href="#"><svg class="bi" width="24" height="24"><use xlink:href="#twitter"/></svg></a></li>
        <li class="ms-3"><a class="link-dark" href="#"><svg class="bi" width="24" height="24"><use xlink:href="#instagram"/></svg></a></li>
        <li class="ms-3"><a class="link-dark" href="#"><svg class="bi" width="24" height="24"><use xlink:href="#facebook"/></svg></a></li>
      </ul>
    </div>
  </footer>
</div>
{% endblock footer %}

{% block scripts %}
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>
  <script>
  
    const delete_msg = (e) => {
        let ref = e.id
        console.log(ref)
        // post message id to backend
        $.ajax({
          type: "POST",
          url: "{{url_for('main.delete_msg') }}",
          data: {"ref" : ref },
          dataType: 'json',
          
        })
        
        // reload window to trigger change
        window.location.reload();
    }

  </script>
{% endblock scripts %}
  

